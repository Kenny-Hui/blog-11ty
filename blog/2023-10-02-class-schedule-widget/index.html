<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>I made a class schedule widget</title>
		<meta name="description" content="I am writing about my experiences as a naval navel-gazer.">
		<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="LXBlog">
		<link rel="alternate" href="/feed/feed.json" type="application/json" title="LXBlog">
		<meta name="generator" content="Eleventy v2.0.1">
		
		<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
		
		<style>/**
 * okaidia theme for JavaScript, CSS and HTML
 * Loosely based on Monokai textmate theme by http://www.monokai.nl/
 * @author ocodia
 */

code[class*="language-"],
pre[class*="language-"] {
	color: #f8f8f2;
	background: none;
	text-shadow: 0 1px rgba(0, 0, 0, 0.3);
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
	border-radius: 0.3em;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #272822;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: #8292a2;
}

.token.punctuation {
	color: #f8f8f2;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.constant,
.token.symbol,
.token.deleted {
	color: #f92672;
}

.token.boolean,
.token.number {
	color: #ae81ff;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #a6e22e;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string,
.token.variable {
	color: #f8f8f2;
}

.token.atrule,
.token.attr-value,
.token.function,
.token.class-name {
	color: #e6db74;
}

.token.keyword {
	color: #66d9ef;
}

.token.regex,
.token.important {
	color: #fd971f;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0,0,0,.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}
* { box-sizing: border-box; }
/* Defaults */
:root {
	--font-family: 'Roboto', sans-serif;
	--font-family-monospace: monospace;
}

/* Theme colors */
:root {
	--text-color: var(--color-gray-90);

	--color-gray-10: #aaa;
	--color-gray-20: #e0e0e0;
	--color-gray-50: #C0C0C0;
	--color-gray-90: #dad8d8;
	--color-bg-highlight: #333;

	--background-color: #222;
	--html-background-color: #191919;
	--codeblock-background: #3B3B3B;

	/* --text-color is assigned to --color-gray-_ above */
	--text-color-link: #66C2fc;
	--text-color-link-active: #ff88aa;

	--syntax-tab-size: 2;
}

/* Global stylesheet */
* {
	box-sizing: border-box;
}

html, body {
	padding: 0;
	margin: 0 auto;
	font-family: var(--font-family);
	color: var(--text-color);
	font-size: 1.025rem;
}

html::before {
	position: fixed;
	content: "";
	width: 100%;
	height: 100%;
	z-index: -1;
}

html {
	background-color: var(--html-background-color);
}

body {
	max-width: 42em;
}

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

p:last-child {
	margin-bottom: 0;
}

p {
	line-height: 1.7;
}

li {
	line-height: 1.5;
}

a[href] {
	color: var(--text-color-link);
}
a[href]:hover,
a[href]:active {
	color: var(--text-color-link-active);
}

main {
	padding: 1rem;
	position: relative;
	background: var(--background-color);
}
main :first-child {
	margin-top: 0;
}
header:before {
	content: "";
	position: absolute;
	width: 100%;
	height: 100%;
	background: linear-gradient(to bottom, transparent, var(--color-bg-highlight));
	transform: perspective(800px) rotateX(60deg);
	transform-origin: 50% 100%;
	z-index: -1;
}

header {
	position: relative;
	display: flex;
	justify-content: space-between;
}

header:after {
	content: "";
	position: absolute;
	bottom: 0;
	left: 0;
	height: 1px;
	width: 100%;
	background: linear-gradient(to right, transparent 10%, var(--text-color) 50%, transparent 90%)
}

header > nav {
	margin-left: auto;
}

.links-nextprev {
	display: flex;
	position: relative;
	justify-content: space-between;
	padding: 1em 0;
}

.links-nextprev:before {
	content: "";
	position: absolute;
	top: 0;
	left: 0;
	height: 1px;
	width: 100%;
	background: linear-gradient(to right, transparent 0%, var(--text-color) 50%, transparent 100%)
}

table {
	margin: 1em 0;
}

table td,
table th {
	padding-right: 1em;
}

pre,
code {
	font-family: var(--font-family-monospace);
	font-size: 0.80rem;
	background: var(--codeblock-background);
}

pre:not([class*="language-"]) {
	margin: .5em 0;
	line-height: 1.375; /* 22px /16 */
	-moz-tab-size: var(--syntax-tab-size);
	-o-tab-size: var(--syntax-tab-size);
	tab-size: var(--syntax-tab-size);
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
}

code {
	word-break: break-all;
}

p > code, li > code {
	border: 1px solid black;
}

/* Header */
header {
	display: flex;
	gap: 1em .5em;
	flex-wrap: wrap;
	align-items: center;
	padding: 1em 0;
}

.home-link {
	font-size: 1em; /* 16px /16 */
	font-weight: 600;
	margin-right: 2em;
}

.home-link:link:not(:hover) {
	text-decoration: none;
}

/* Nav */
.nav {
	display: flex;
	padding: 0;
	margin: 0;
	list-style: none;
}

.nav-item {
	display: inline-block;
	margin-right: 1em;
}

.nav-item a[href]:not(:hover) {
	text-decoration: none;
}

.nav a[href][aria-current="page"] {
	text-decoration: underline;
}

/* Posts list */
.postlist {
	list-style: none;
	padding: 0;
}
.post-desc {
	color: #888;
	font-style: italic;
}

.postlist-item {
	background: var(--color-bg-highlight);
	align-items: baseline;
	margin-bottom: 1em;
}

.postlist-date,
.postlist-item::before {
	font-size: 0.8125em; /* 13px /16 */
	color: var(--color-gray-90);
}

.postlist-date {
	word-spacing: -0.5px;
}

.postlist-tags {
	margin-left: 0.25em;
}

.postlist-tag {
	position: relative;
	display: inline-block;
	text-decoration: none;
	padding: 0 0.60em;
	z-index: 1;
}

.postlist-tag::after {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	content: "";
	padding: 0 0.1em;
	transform: skewX(-15deg);
	background: var(--codeblock-background);
	z-index: -4;
	border-right: 1px solid gray;
}

.postlist-tag:last-child::after {
	border-right: none;
}

.postlist-tag:hover::after {
	background: rgba(255, 255, 255, 0.2);
}

.tag {
	font-size: 14px;
	padding: 0 12px;
	clip-path: polygon(calc(100% - 6px) 0, 100% 50%, calc(100% - 6px) 100%, 6px 100%, 0 50%, 6px 0);
}

.red {
	background: #FF3311;
}

.ace {
	display: inline-block;
	height: 1em;
	width: 1.5em;
	border-radius: 2px;
	background-image: linear-gradient(#000 25%, #A4A4A4 25%, #A4A4A4 50%, #FFF 50%, #FFF 75%, #810081 75%, #810081 100%);
}

main img {
	max-width: 100%;
	height: auto;
}

@keyframes load {
	0% {
		opacity: 0;
	}
	100% {
		opacity: 1;
	}
}

@media (prefers-reduced-motion: no-preference) {
	main {
		animation: 0.5s load;
	}
}

.postlist-link {
	font-size: 1.1875em; /* 19px /16 */
	font-weight: 500;
	flex-basis: calc(100% - 1.5rem);
	padding-right: .75em;
	text-underline-position: from-font;
	text-underline-offset: 0;
	text-decoration-thickness: 1px;
}

.postlist-item-active .postlist-link {
	font-weight: bold;
}

/* Tags */
.post-tag {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	text-transform: capitalize;
}

.postlist-item > .post-tag {
	align-self: center;
}

.news {
	background: black;
	color: white;
}

.news > span {
	margin-right: 30px;
}

/* Tags list */
.post-metadata {
	display: inline-flex;
	flex-wrap: wrap;
	gap: .5em;
	list-style: none;
	padding: 0;
	margin: 0;
}

.post-metadata time {
	margin-right: 1em;
}

/* Direct Links / Markdown Headers */
.header-anchor {
	text-decoration: none;
	font-style: normal;
	font-size: 1em;
	margin-left: .1em;
}

a[href].header-anchor,
a[href].header-anchor:visited {
	color: transparent;
}

a[href].header-anchor:focus,
a[href].header-anchor:hover {
	text-decoration: underline;
}

a[href].header-anchor:focus,
:hover > a[href].header-anchor {
	color: #aaa;
}

h2 + .header-anchor {
	font-size: 1.5em;
}

footer {
	border-top: 1px solid gray;
}

.footer {
	display: flex;
	justify-content: space-between;
	padding: 1em 0;
	text-align: center;
}

.footer2 {
	margin-bottom: 1em;
}

.prevnext-post {
	display: inline-block;
	border: 1px solid var(--color-gray-90);
	font-size: 16px;
	color: white;
	padding: 10px;
}

.prevnext-post:hover {
	background: var(--color-gray-90);
	color: #000;
}

/* >:( */
.ARGH {
	text-shadow: 0px 0px 12px #F00, 0px 0px 12px #F00;
}

.sub {
	font-size: 0.9em;
	color: var(--color-gray-10);
}

.highlight {
	color: #FFF;
	background: #111;
	border-radius: 4px;
	padding: 0 .25em;
}

.aesthetics {
	text-shadow: 1px 1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, -1px -1px 0 #000;
	font-weight: 500;
	background: linear-gradient(90deg, rgba(255,0,0,0.75) 15%, rgba(255,154,0,0.75) 30%, rgba(208,222,33,0.75) 45%, rgba(39,140,34,0.75) 60%,rgba(28,127,238,0.75) 80%, rgba(95,21,242,0.75) 100%);
}

.hint {
	filter: contrast(5);
	background: #6C6C6C;
}</style>
	</head>

	<body>
		<a href="#skip" class="visually-hidden">Skip to main content</a>
		<header>
			<a href="/" class="home-link">
				
					<img width=120px src="/img/logo.png" alt="LXBlog">
				
			</a>
			<nav>
				<h2 class="visually-hidden">Top level navigation menu</h2>
				<ul class="nav">
					<li class="nav-item"><a href="/mainpage/">Main Page</a></li>
					<li class="nav-item"><a href="/">Blog</a></li>
					<li class="nav-item"><a href="/about/">About</a></li>
				</ul>
			</nav>
		</header>

		<main id="skip">
			

<h1>I made a class schedule widget</h1>
<p class="post-desc"></p>

<ul class="post-metadata">
	<li>Posted: <time datetime="2023-10-02">2023-10-02</time></li>
		<li><a href="/tags/school/" class="post-tag">school</a></li>
</ul>

<p>A while back I vented a bit over on twitter:</p>
<p><picture><source type="image/avif" srcset="/img/JHZU7uvT5a-732.avif 732w"><source type="image/webp" srcset="/img/JHZU7uvT5a-732.webp 732w"><img alt="Unpopular opinion, but school's mobile app should have a static notification of what lesson is currently happening, what room to go, and how much time is left. Giving me a timetable of today's lesson is no different than sending a jpeg." loading="lazy" decoding="async" src="/img/JHZU7uvT5a-732.png" width="732" height="184"></picture></p>
<p>As with my other venting tweets at the time, I have briefly thought about doing something with it, but ended up being too lazy to care and moves on.</p>
<p>That is until the next day, one of my friend sent me a picture of their home screen with a widget showing the current and the upcoming class information, the location and the time period of their school.</p>
<p>Yes it isn't a static notification I was initially expecting, but nevertheless it does the job, and it does it quite well, so I started looking for a way to achieve the same with my school.</p>
<p>I obviously don't want to manually enter each course, otherwise it would be a PITA on every new semester (And also as it turns out, occasionally the classroom would shift depending on different weeks), so I have to figure out a way to get the real-time class schedule from the school.</p>
<h2 id="figuring-out-the-api" tabindex="-1">Figuring out the API <a class="header-anchor" href="#figuring-out-the-api">#</a></h2>
<p>My first instinct would be to get the timetable from our school's portal website, which looks like it's something made in 2004.</p>
<p><picture><source type="image/avif" srcset="/img/SXjevR_fzq-1034.avif 1034w"><source type="image/webp" srcset="/img/SXjevR_fzq-1034.webp 1034w"><img alt="Our school's portal website, displaying the timetable view." loading="lazy" decoding="async" src="/img/SXjevR_fzq-1034.png" width="1034" height="928"></picture></p>
<p>In the portal, you can request a week (Or multiple week, but it doesn't work on student account as far as I am aware) of timetable, it then sends an AJAX call and the server returns back the timetable page in HTML.</p>
<p><picture><source type="image/avif" srcset="/img/BB2fOw3cnv-606.avif 606w"><source type="image/webp" srcset="/img/BB2fOw3cnv-606.webp 606w"><img alt="Chromium's DevTool, showing the response of the timetable page in HTML" loading="lazy" decoding="async" src="/img/BB2fOw3cnv-606.png" width="606" height="479"></picture></p>
<p>Thanks I hated it! Sure if I really want to reverse engineer this thing I probably could have figured it out somehow, but why go the hard way when there's an easy way, so I started digging through the school's mobile app (Which is what my original tweet is targetting anyway).</p>
<p>With the help of old insecure android version in an emulator &amp; mitmproxy I did get the endpoint, got it to authenticate (Just some basic username password authentication) and obtained the timetable data, now in JSON!</p>
<p><picture><source type="image/avif" srcset="/img/o0Jczopy_a-624.avif 624w"><source type="image/webp" srcset="/img/o0Jczopy_a-624.webp 624w"><img alt="A JSON Timetable response from the school's API" loading="lazy" decoding="async" src="/img/o0Jczopy_a-624.png" width="624" height="700"></picture></p>
<p>Good, now let's actually build the app.</p>
<h2 id="what-the-and-is-this-thing" tabindex="-1">What the &amp;#@\ is this thing <a class="header-anchor" href="#what-the-and-is-this-thing">#</a></h2>
<p>When I first started this, I have absolutely no android app developing experience. I haven't tried Kotlin before, I have no idea what is an Activity, Fragment, Intent, the only time I ever touched Android Studio is for their Android Virtual Device.</p>
<p>I am not going to go through how I learned them as that isn't the main point (And if anything I shouldn't be the one qualified to document them), but overall my impression of native Android Development is that you need to be willing to learn a lot of concept rather than expecting things to work after maybe copying a few lines of example code then using it. (Especially Intent/Broadcasts), and that now all of a sudden React Native doesn't seems that crazy after all.</p>
<p>Anyways a few weeks in, the app is now in a functional state, I can log in to a school account, it will display the course appropriately, everything works.</p>
<p><picture><source type="image/avif" srcset="/img/jzyGbubMCm-391.avif 391w"><source type="image/webp" srcset="/img/jzyGbubMCm-391.webp 391w"><img alt="My initial android app showing class schedules of today, in a card list" loading="lazy" decoding="async" src="/img/jzyGbubMCm-391.png" width="391" height="864"></picture></p>
<p>Except for the static notification, which is the whole point of the app.<br>
Either the notification doesn't get updated, the timer is wrong, etc.<br>
I've spent weeks tinkering with it with no success, so I left the entire app in the dust and moved on with my life.</p>
<p>That is until around a year later when a new school year began, that means I have to completely re-adjust my schedules, and that also means having to pull up the timetable image/mobile app on every lesson change to know where am I suppose to go, and start memorizing it all over again.</p>
<p>Eventually I am fed up, so I decided to make the class schedule app again, this time in the form of android widget (Which I should have been in the beginning).<br>
Note that I have since graduated and was no longer in the school I was previously in, but it is still under the same organization and they use the same system, so all the knowledge I've discovered a year ago still applies!</p>
<p>And after a week of bashing my head against the computer, it has finally been done.</p>
<p><picture><source type="image/avif" srcset="/img/_tg72UyD-A-768.avif 768w"><source type="image/webp" srcset="/img/_tg72UyD-A-768.webp 768w"><img alt="My self-made class schedule widget." loading="lazy" decoding="async" src="/img/_tg72UyD-A-768.png" width="768" height="692"></picture></p>
<p>It's not fancy nor polished at the moment, it doesn't properly display across months, it likely doesn't support having multiple widget at once, nor does it handle holiday and exam schedule (Which the official school mobile app does).</p>
<p>But I am very happy with the end result, using and solving my own daily life problems/annoyances are always the best, this is one of the few projects that I get to do so, and I very much enjoy it :D</p>
<p>For now I don't think I will continue devote a lot of time to this widget, primarily I am not sure how happy my school would be if I distribute this thing, and tbh it's enough for my usage, although I hope it will reach a production-ready state one day.</p>
<p>That's about it, see you in the future :^)</p>

<ul class="links-nextprev">
		<a href="/blog/2023-07-28-mc-1.19-memory/">
			<div class="prevnext-post">
				<< Previously: High memory usage on Minecraft 1.18+
			</div>
		</a>
	
</ul>

		</main>

		<footer>
			<div class="footer">
				<span>LX86 2023</span>
				<div>
					<a href="/feed/feed.xml">RSS</a>
					<a href="mailto:lx86@lx862.com">Email</a>
				</div>
				<span>Last updated: <time datetime="2023-10-02">2023-10-02</span>
			</div>
			<div class="footer2">
				<span>All content are under <a href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a> unless noted otherwise</span>
			</div>
			
		</footer>

<!--		 Current page: /blog/2023-10-02-class-schedule-widget/-->
	</body>
</html>
